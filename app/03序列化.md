## 模型序列化器
为了方便我们定义序列化器,drf提供了`ModelSerializer`模型类序列化器来快速创建一个`Serializer`类  
`ModelSerializer`与常规`Serializer`相同,但提供了
- 基于模型类自动生成一系列字段
- 基于模型类自动为`Serializer`生成`validators`,比如`unique_together`
- 包含默认的`create()`和`update()`实现

### 1. 模型序列化器的使用
- 定义模型序列化器类,直接继承自`serializers.ModelSerializer`即可
app/serializers.py
```python
from rest_framework import serializers

from app.models import UserInfo, Addr

class UserInfoSerializer(serializers.ModelSerializer):
    """定义用户序列化器"""

    class Meta:
        model = UserInfo
        fields = '__all__'

class AddrSerializer(serializers.ModelSerializer):
    """定义地址序列化器"""
    
    class Meta:
        model = Addr
        fields = '__all__'
```
- 指定模型类和需要序列化的字段
  - model指明参数哪个模型
  - fields指明为模型类的哪些字段生成

### 2. 获取数据
```python
#导入序列化器类
from app.serializers import UserInfoSerializer
#导入模型类
from app.models import UserInfo
#获取查询集,即queryset对象
all = UserInfo.objects.all()
#转换为序列化器对象
all_ser = UserInfoSerializer(instance=all,many=True)
#打印数据
all_ser.data
```


### 2. 指定字段
**a** fields
- fields = `__all__` 代表模型类中所有字段都进行序列化
- 也可以通过fields指定具体字段
app/serializers.py
```python
from rest_framework import serializers

from app.models import UserInfo, Addr


class UserInfoSerializer(serializers.ModelSerializer):
    """定义用户序列化器"""

    class Meta:
        model = UserInfo
        # 所有字段
        # fields = '__all__'
        # 指定序列化字段
        fields = ('id','age','pwd')
```

**b** exclude
- 使用`exclude`排除指定字段
  app/serializers.py
```python
from rest_framework import serializers

from app.models import UserInfo, Addr


class UserInfoSerializer(serializers.ModelSerializer):
    """定义用户序列化器"""

    class Meta:
        model = UserInfo
        # 所有字段
        # fields = '__all__'
        # 指定序列化字段
        # fields = ('id','age','pwd')
        # 字段id不参与序列化,注意,此字段值必须为 list or tuple
        exclude = ('id',)
```

**c** read_only_fields
- 通过read_only_fields可以指明只读的字段
app/serializers.py
```python
from rest_framework import serializers

from app.models import UserInfo, Addr

class UserInfoSerializer(serializers.ModelSerializer):
  """定义用户序列化器"""

  class Meta:
    model = UserInfo
    # 所有字段
    fields = '__all__'
    # 指定序列化字段
    # fields = ('id','age','pwd')
    # 字段id不参与序列化,注意,此字段值必须为 list or tuple
    # exclude = ('id',)
    read_only_fields = ("id",)
```

**d** 修改字段的参数选项
- 使用`extra_kwargs`参数为`ModelSerializer`添加或修改原有的选项参数
  - 通过修改字段名指定字段对应的参数和值

app/serializers.py
```python
from rest_framework import serializers

from app.models import UserInfo, Addr


class UserInfoSerializer(serializers.ModelSerializer):
    """定义用户序列化器"""

    class Meta:
        model = UserInfo
        # 所有字段
        fields = '__all__'
        # 指定序列化字段
        # fields = ('id','age','pwd')
        # 字段id不参与序列化,注意,此字段值必须为 list or tuple
        # exclude = ('id',)
        # read_only_fields = ("id",)
        # 使用extra_kwargs 去修改指定字段的校验规则(反序列化的校验规则)
        extra_kwargs = {
            'pwd': {
                'required': True,
                'min_length': 8,
                'max_length': 20,
                'error_messages': {
                    ''
                }
            }
        }
```

### 3. 序列化器保存数据
```python
#导入序列化器类
from app.serializers import UserInfoSerializer
#导入模型类
from app.models import UserInfo
#获取查询集,即queryset对象
data = {
  "name":"李四海",
  'pwd':"123456",
  "email":"123456@qq.com",
  "age": 21
}
#转换为序列化器对象
all_ser = UserInfoSerializer(data=data)
#验证数据
all_ser.is_valid()
#打印数据,这里drf序列化器类提示,不能直接访问all_ser.data数据,可以通过validated_data属性查看
all_ser.validated_data
#保存数据
all_ser.save()
#修改数据,获取最后一个数据
user_last = UserInfo.objects.last()
#修改最后年龄,在原有基础上加1
data = {
  "id":  UserInfoSerializer(instance=user_last).data.get("id"),
  "age": UserInfoSerializer(instance=user_last).data.get("age")+1,
  "name": UserInfoSerializer(instance=user_last).data.get("name"),
  "pwd": UserInfoSerializer(instance=user_last).data.get("pwd"),
  "email": UserInfoSerializer(instance=user_last).data.get("email"),
}
#传入序列化实例和数据
user_last_update_ser = UserInfoSerializer(instance=all_ser,data=data)
#校验数据
user_last_update_ser.is_valid()
#保存数据
user_last_update_ser.save()
```

