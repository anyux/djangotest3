## 跨域
### 1. cors 跨域问题
针对于前后端分离的项目,前端和后端是分开部署的,因此服务端要支持cors(跨域资源共享)策略,需要在响应头中加上`Access-Control-Allow-Origin: *`

| 位置   | 域名             |
|------|----------------|
| 前端服务 | 127.0.0.1:8080 |
| 后端服务 | 127.0.0.1:8000 |

前端与后端分别是不同的端口,这就涉及到跨域访问数据的问题,因此浏览器同源策略,默认是不支持两个不同的域名间相互访问
需要后端添加跨域访问支持

### 2.后端 django配置

1. django-cors-headers
```bash
pip install django-cors-headers
```
2. 添加应用
   settings.py
```python
INSTALLED_APPS = [
    'django.contrib.auth',
    'django.contrib.admin',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'corsheaders',
]
```
配置跨域中间件
settings.py
```python
MIDDLEWARE = [
    #跨域中间件
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    # 'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
```
配置开放白名单
settings.py
```python
#CORS
#对外开放白名单
CORS_ORIGIN_ALLOW_ALL = True
#允许跨域操作session会放
CORS_ALLOW_CREDENTIALS = True
#指定可以访问的跨域ip或域名
CORS_ORIGIN_WHITELIST = (
    'http://127.0.0.1:8080',
    "http://192.168.8.101:8080",
)
```
- 浏览器会在第一次发送options请求询问后端是否允许跨域
- 后端在响应结果中告知浏览器允许跨域,允许的情况下浏览器再发送跨域请求

### 3.前端: axios配置
```javascript
// 允许axios跨域携带cookie
axios.defaults.withCredentials = true
```

## DRF JWT

### 1. token 鉴权和JWT介绍
针对前后端分离的项目,ajax跨域请求时,不会自动携带cookie信息,就是后端也再使用session认证机制  
改为使用JWT(json web token) 认证机制,JWT是目前最流行的跨域身份解决方案

**a** token鉴权机制

### 2. JWT 构成
一个jwt由三部分构成,头部(header),载荷(payload),签名(signature)
```jwt
header.payload.signature
```

**a** header
头部中一般包含两部分信息: 一部分是类型,一部分是加密算法
头部数据
```python
{
    'typ': 'JWT',
    'alg': 'hS256'
}
```
将头部数据base64加密后,构成第一部分
加密后的头部
```text
ewogICAgJ3R5cCc6ICdKV1QnLAogICAgJ2FsZyc6ICdoUzI1NicKfQ==
```
**b** payload
载荷是jwt的主体内容部分,里面存放有效信息,jwt定义了几个标准字段
- iss: jwt签发者
- sub: jwt面向用户
- aud: jwt接收方
- exp: 过期时间,uninx时间戳
- at:  jwt签发时间

除了标准定义中的字段,还可以自定义字段

**c** signature
签名是jwt中比较重要的部分,前面两部分是使用base64编码,signature使用编码后的header和payload以及提供了密钥, 
使用header中指定的签名算法(HS256)进行签名,签名的作是保障JWT没有被篡改过
签名由三部分组成
- header: base64编码后的
- payload: base64编码后的
- secret: 私钥

加密后的header+加密后的payload + 私钥secret 古都结合,使用加密算法,得到最后的签名


### 2. simplejwt
**a** 安装djangorestframework-simplejwt
```bash
pip install djangorestframework-simplejwt
```

